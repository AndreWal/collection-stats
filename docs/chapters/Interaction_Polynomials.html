<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Context Matters: A Guide to Interaction Terms – From Beta to Meaning: A Guide to Interpreting Regression Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/Comparing_Estimates.html" rel="next">
<link href="../chapters/Categorical_Compositional.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-7bc9e07932f8ae97e807bea6fb42db08.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/Interaction_Polynomials.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Context Matters: A Guide to Interaction Terms</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">From Beta to Meaning: A Guide to Interpreting Regression Analysis</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">From Beta to Meaning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/Categorical_Compositional.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Categorical and Compositional Predictors: A Guide</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/Interaction_Polynomials.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Context Matters: A Guide to Interaction Terms</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/Comparing_Estimates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Comparing Estimates Correctly: Why ‘Significant’ vs ‘Not Significant’ Is Not a Difference</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#interaction-terms-as-context" id="toc-interaction-terms-as-context" class="nav-link active" data-scroll-target="#interaction-terms-as-context"><span class="header-section-number">3.1</span> Interaction Terms as Context</a></li>
  <li><a href="#what-is-an-interaction-term" id="toc-what-is-an-interaction-term" class="nav-link" data-scroll-target="#what-is-an-interaction-term"><span class="header-section-number">3.2</span> What is an Interaction Term?</a></li>
  <li><a href="#a-brief-digression-polynomial-regression" id="toc-a-brief-digression-polynomial-regression" class="nav-link" data-scroll-target="#a-brief-digression-polynomial-regression"><span class="header-section-number">3.3</span> A Brief Digression: Polynomial Regression</a></li>
  <li><a href="#practical-pitfalls" id="toc-practical-pitfalls" class="nav-link" data-scroll-target="#practical-pitfalls"><span class="header-section-number">3.4</span> Practical Pitfalls</a></li>
  <li><a href="#appendix-which-specification-when-cheat-sheet" id="toc-appendix-which-specification-when-cheat-sheet" class="nav-link" data-scroll-target="#appendix-which-specification-when-cheat-sheet"><span class="header-section-number">3.5</span> Appendix: “Which Specification When?” Cheat Sheet</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">3.6</span> Further Reading</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Context Matters: A Guide to Interaction Terms</span></h1>
<p class="subtitle lead">From marginal effects to meaningful moderator interpretation</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><em>Disclaimer: All data used in this chapter is simulated and does not reflect real-world data. The purpose of this chapter is to illustrate the concept of interaction terms in linear regression models, not to make any claims about the relationship between age, income, and ideological placement.</em></p>
<section id="interaction-terms-as-context" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="interaction-terms-as-context"><span class="header-section-number">3.1</span> Interaction Terms as Context</h2>
<blockquote class="blockquote">
<p>“If You Are Not a Liberal at 25, You Have No Heart. If You Are Not a Conservative at 35 You Have No Brain”</p>
<p>— <a href="https://quoteinvestigator.com/2014/02/24/heart-head/">Quote Investigator</a></p>
</blockquote>
<p>Researchers often want to know whether relationships differ across contexts. I use ideological self-placement as the running example. More specifically, I want to know whether age affects left-right self-placement. In addition, I assume that income affects ideological leanings as well, meaning that voters at the lower end of the income distribution are typically more left than voters on the higher end of the income distribution. So, how can interaction terms help us understand the relationship between age, income and ideological placement? Does the relationship between age and ideological placement differ across income levels? If so, how can I model this relationship?</p>
</section>
<section id="what-is-an-interaction-term" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="what-is-an-interaction-term"><span class="header-section-number">3.2</span> What is an Interaction Term?</h2>
<p>In this example, <code>income</code> is measured in tens of thousands, and <code>leftRight</code> is a 0-10 self-placement scale where higher values indicate more right-leaning views. The simulated data are generated with the following true parameters: the baseline effect of age on ideology is <span class="math inline">\(\beta_1 = 0.02\)</span>, the main effect of income is <span class="math inline">\(\beta_2 = 0.15\)</span>, and the interaction is <span class="math inline">\(\beta_3 = 0.004\)</span>. This means the true marginal effect of age on left-right placement is <span class="math inline">\(0.02 + 0.004 \times income\)</span>, so the age effect increases by 0.004 for each additional unit of income.</p>
<p>I established in the previous chapter that a coefficient in a regression model represents the average effect of a predictor variable on the response variable, holding all other variables constant. However, this assumes that the effect of the predictor is the same across all contexts. Using a linear regression model with a continuous response variable <code>leftRight</code> and a predictor variable <code>age</code>, I can illustrate this point. Mathematically, our model without an interaction term looks as follows:</p>
<p><span id="eq-reg"><span class="math display">\[
leftRight_i = \alpha + \beta_1 age_i + \epsilon_i
\tag{3.1}\]</span></span></p>
<p><a href="#eq-reg" class="quarto-xref">Equation&nbsp;<span>3.1</span></a> shows that the marginal effect of a predictor variable in a linear regression model is represented by the coefficient <span class="math inline">\(\beta_1\)</span>. To understand interactions, it is helpful to know that the marginal effect of a predictor can be read directly from the equation because it is the partial derivative of the response variable with respect to the predictor variable. In our simple regression model, the marginal effect of <code>age</code> is <span class="math inline">\(\beta_1\)</span>, which means that for every one-unit increase in <code>age</code>, the expected change in <code>leftRight</code> is <span class="math inline">\(\beta_1\)</span> units. Mathematically, the partial derivative of <a href="#eq-reg" class="quarto-xref">Equation&nbsp;<span>3.1</span></a> can be expressed as: <span id="eq-derivative"><span class="math display">\[
\frac{\partial leftRight_i}{\partial age_i} = \beta_1
\tag{3.2}\]</span></span></p>
<p>In R, this model can be estimated using the <code>lm()</code> function as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(leftRight <span class="sc">~</span> age, <span class="at">data =</span> data)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = leftRight ~ age, data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.5059 -0.8757 -0.0084  0.9727  3.0922 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 3.697214   0.118956   31.08   &lt;2e-16 ***
age         0.045269   0.002289   19.78   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.289 on 998 degrees of freedom
Multiple R-squared:  0.2816,    Adjusted R-squared:  0.2809 
F-statistic: 391.3 on 1 and 998 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>So, why is this important to understand interaction terms? An interaction term is essentially a multiplicative combination of two predictor variables. When I include an interaction term in the regression model, I simply add two predictors and their product to the equation. Let’s assume that I want to know whether the effect of <code>age</code> on <code>leftRight</code> depends on the income of a respondent. Our regression model with the interaction term would look like this: <span id="eq-reg-interaction"><span class="math display">\[
leftRight_i = \alpha + \beta_1 age_i + \beta_2 income_i + \beta_3 (age_i \times income_i) + \epsilon_i
\tag{3.3}\]</span></span></p>
<p>If I take the partial derivative of <a href="#eq-reg-interaction" class="quarto-xref">Equation&nbsp;<span>3.3</span></a> with respect to <code>age</code>, I get: <span id="eq-derivative-interaction"><span class="math display">\[
\frac{\partial leftRight_i}{\partial age_i} = \beta_1 + \beta_3 income_i
\tag{3.4}\]</span></span></p>
<p>As <a href="#eq-derivative-interaction" class="quarto-xref">Equation&nbsp;<span>3.4</span></a> shows, the effect of <code>age</code> on <code>leftRight</code> is no longer constant but depends on the value of <code>income</code>. The coefficient <span class="math inline">\(\beta_3\)</span> represents the change in the effect of <code>age</code> for each one-unit increase in <code>income</code>. If <span class="math inline">\(\beta_3\)</span> is positive, it means that the effect of <code>age</code> on <code>leftRight</code> increases as income increases. Conversely, if <span class="math inline">\(\beta_3\)</span> is negative, it means that the effect of <code>age</code> on <code>leftRight</code> decreases as income increases.</p>
<p>In R, this would look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(leftRight <span class="sc">~</span> age <span class="sc">*</span> income, <span class="at">data =</span> data)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = leftRight ~ age * income, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.45589 -0.55774  0.02019  0.56182  2.66821 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 2.4255133  0.2030559  11.945  &lt; 2e-16 ***
age         0.0224525  0.0038078   5.896 5.08e-09 ***
income      0.1625065  0.0264208   6.151 1.12e-09 ***
age:income  0.0037022  0.0005002   7.401 2.86e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.8063 on 996 degrees of freedom
Multiple R-squared:  0.7196,    Adjusted R-squared:  0.7187 
F-statistic: 851.9 on 3 and 996 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>(R adds the constitutive terms automatically when you use the <code>*</code> operator between two variables in the formula.)</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The Interaction Coefficient Is Not the Full Story
</div>
</div>
<div class="callout-body-container callout-body">
<p>The coefficient on the interaction term (<span class="math inline">\(\hat\beta_3\)</span>) tells you the <em>rate of change</em> of the marginal effect, not the marginal effect itself. The marginal effect of <code>age</code> at any given income level is <span class="math inline">\(\hat\beta_1 + \hat\beta_3 \times income\)</span>. Always compute and visualize the full marginal effect across the moderator’s range rather than interpreting <span class="math inline">\(\hat\beta_3\)</span> in isolation.</p>
</div>
</div>
<p>Even though it is more informative to plot the interaction to understand how the effect of <code>age</code> changes across different income levels, I can also look at the coefficients to get a sense of the interaction. First, I can see that the coefficient for <code>age</code> is positive. However, the coefficient for <code>age</code> gives us only the effect of <code>age</code> when <code>income</code> is zero, which is not a meaningful value in this context. A solution here would be to center the <code>income</code> variable around its mean before including it in the regression model. This way, the coefficient for <code>age</code> would represent the effect of <code>age</code> at the average income level.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
On Centering Predictors
</div>
</div>
<div class="callout-body-container callout-body">
<p>Centering continuous predictors before including them in interaction models serves two purposes: (1) it makes the constitutive terms (<span class="math inline">\(\hat\beta_1\)</span>, <span class="math inline">\(\hat\beta_2\)</span>) directly interpretable at the mean of the other variable rather than at zero, and (2) it can reduce multicollinearity between the interaction term and its constitutive terms, improving numerical stability. Centering does not change the interaction coefficient, the marginal effects, or the model fit but only the interpretation of the lower-order coefficients.</p>
</div>
</div>
<p>Second, the coefficient for the interaction term <code>age:income</code> is positive, which indicates that the effect of <code>age</code> on <code>leftRight</code> increases as income increases. This means that age is more strongly associated with rightward placement among higher-income respondents than among lower-income respondents. Therefore, the table alone already gives us a pretty good idea of the interaction, but it is often more intuitive to visualize it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model with interaction</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(leftRight <span class="sc">~</span> age <span class="sc">*</span> income, <span class="at">data =</span> data)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coefficients and variance-covariance matrix</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(model)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>vcov_matrix <span class="ot">&lt;-</span> <span class="fu">vcov</span>(model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>income_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">12</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>effect <span class="ot">&lt;-</span> coefs[<span class="dv">2</span>] <span class="sc">+</span> coefs[<span class="dv">4</span>] <span class="sc">*</span> income_seq</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(vcov_matrix[<span class="dv">2</span>, <span class="dv">2</span>] <span class="sc">+</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>           income_seq<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> vcov_matrix[<span class="dv">4</span>, <span class="dv">4</span>] <span class="sc">+</span> </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>           <span class="dv">2</span> <span class="sc">*</span> income_seq <span class="sc">*</span> vcov_matrix[<span class="dv">2</span>, <span class="dv">4</span>])</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>ci_lower <span class="ot">&lt;-</span> effect <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>ci_upper <span class="ot">&lt;-</span> effect <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plot</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(income_seq, effect, </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(ci_lower), <span class="fu">max</span>(ci_upper)),</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Income (tens of thousands)"</span>,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"Effect of Age on Left-Right Placement"</span>,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Marginal Effect of Age by Income</span><span class="sc">\n</span><span class="st">(with 95% Confidence Intervals)"</span>)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Add confidence interval as shaded region</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(income_seq, <span class="fu">rev</span>(income_seq)), </span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(ci_upper, <span class="fu">rev</span>(ci_lower)),</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">rgb</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="fl">0.2</span>),</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Add reference line at y=0</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"gray"</span>, <span class="at">lwd =</span> <span class="dv">1</span>)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-plot the line on top</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(income_seq, effect, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-marginal-effect-income" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-marginal-effect-income-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Interaction_Polynomials_files/figure-html/fig-marginal-effect-income-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-marginal-effect-income-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1: Marginal effect of age on left-right placement across income levels. The effect is positive throughout the observed income range but increases with income.
</figcaption>
</figure>
</div>
</div>
</div>
<p>To plot the marginal effect of <code>age</code> on <code>leftRight</code> across different income levels, along with 95% confidence intervals, I use the coefficients and variance-covariance matrix from the fitted model. To compute variance for the confidence intervals, I apply the delta method:</p>
<p><span class="math display">\[Var(\beta_1 + \beta_3 \cdot income) = Var(\beta_1) + income^2 \cdot Var(\beta_3) + 2 \cdot income \cdot Cov(\beta_1, \beta_3)\]</span></p>
<p>The plot shows that the estimated effect of <code>age</code> is positive across the observed income range. This visualization gives us a much clearer picture of how the effect of <code>age</code> changes across income levels compared to a regression table. While <code>age</code> increases rightward placement for all income levels, the effect is much stronger for higher-income respondents than for lower-income respondents.</p>
<p>An alternative way to visualize the interaction is to plot predicted values of <code>leftRight</code> across <code>age</code> for different income levels. To do so, I use the 10%, 50%, and 90% quantiles of the <code>income</code> variable to represent low, medium, and high income levels, respectively. I then plot the predicted <code>leftRight</code> values across <code>age</code> for these three income levels, along with confidence intervals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>income_levels <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">quantile</span>(data<span class="sc">$</span>income, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>)))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>income_labels <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">c</span>(<span class="st">"P10 = "</span>, <span class="st">"P50 = "</span>, <span class="st">"P90 = "</span>), <span class="fu">sprintf</span>(<span class="st">"%.1f"</span>, income_levels))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>age_grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">18</span>, <span class="dv">80</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>pred_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> age_grid,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">income =</span> income_levels</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>pred_ci <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> pred_grid, <span class="at">interval =</span> <span class="st">"confidence"</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>pred_grid<span class="sc">$</span>leftRight_hat <span class="ot">&lt;-</span> pred_ci[, <span class="st">"fit"</span>]</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>pred_grid<span class="sc">$</span>ci_lower <span class="ot">&lt;-</span> pred_ci[, <span class="st">"lwr"</span>]</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>pred_grid<span class="sc">$</span>ci_upper <span class="ot">&lt;-</span> pred_ci[, <span class="st">"upr"</span>]</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(age_grid, pred_grid<span class="sc">$</span>leftRight_hat[pred_grid<span class="sc">$</span>income <span class="sc">==</span> income_levels[<span class="dv">1</span>]],</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">"l"</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">range</span>(pred_grid<span class="sc">$</span>ci_lower, pred_grid<span class="sc">$</span>ci_upper),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Age"</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Predicted Left-Right Placement"</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">"Predicted Left-Right by Age</span><span class="sc">\n</span><span class="st">(at Income P10, P50, and P90)"</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(age_grid, <span class="fu">rev</span>(age_grid)),</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(pred_grid<span class="sc">$</span>ci_upper[pred_grid<span class="sc">$</span>income <span class="sc">==</span> income_levels[<span class="dv">1</span>]],</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rev</span>(pred_grid<span class="sc">$</span>ci_lower[pred_grid<span class="sc">$</span>income <span class="sc">==</span> income_levels[<span class="dv">1</span>]])),</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.15</span>),</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age_grid, pred_grid<span class="sc">$</span>leftRight_hat[pred_grid<span class="sc">$</span>income <span class="sc">==</span> income_levels[<span class="dv">2</span>]], <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age_grid, pred_grid<span class="sc">$</span>leftRight_hat[pred_grid<span class="sc">$</span>income <span class="sc">==</span> income_levels[<span class="dv">3</span>]], <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(age_grid, <span class="fu">rev</span>(age_grid)),</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(pred_grid<span class="sc">$</span>ci_upper[pred_grid<span class="sc">$</span>income <span class="sc">==</span> income_levels[<span class="dv">2</span>]],</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rev</span>(pred_grid<span class="sc">$</span>ci_lower[pred_grid<span class="sc">$</span>income <span class="sc">==</span> income_levels[<span class="dv">2</span>]])),</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.15</span>),</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(age_grid, <span class="fu">rev</span>(age_grid)),</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(pred_grid<span class="sc">$</span>ci_upper[pred_grid<span class="sc">$</span>income <span class="sc">==</span> income_levels[<span class="dv">3</span>]],</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rev</span>(pred_grid<span class="sc">$</span>ci_lower[pred_grid<span class="sc">$</span>income <span class="sc">==</span> income_levels[<span class="dv">3</span>]])),</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.15</span>),</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age_grid, pred_grid<span class="sc">$</span>leftRight_hat[pred_grid<span class="sc">$</span>income <span class="sc">==</span> income_levels[<span class="dv">1</span>]], <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age_grid, pred_grid<span class="sc">$</span>leftRight_hat[pred_grid<span class="sc">$</span>income <span class="sc">==</span> income_levels[<span class="dv">2</span>]], <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age_grid, pred_grid<span class="sc">$</span>leftRight_hat[pred_grid<span class="sc">$</span>income <span class="sc">==</span> income_levels[<span class="dv">3</span>]], <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>,</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend =</span> income_labels,</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>),</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-predicted-values" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-predicted-values-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Interaction_Polynomials_files/figure-html/fig-predicted-values-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-predicted-values-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.2: Predicted left-right placement by age at the 10th, 50th, and 90th percentiles of income. The steeper slope for higher income illustrates the positive interaction.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The plot shows that the predicted <code>leftRight</code> values increase with <code>age</code> for all three income levels, but the slope is steeper for higher-income respondents. This visualization provides an alternative way to understand how the relationship between <code>age</code> and <code>leftRight</code> changes across different income levels, compared to the previous plot of marginal effects. Which visualization is more informative depends on the research question and the audience.</p>
</section>
<section id="a-brief-digression-polynomial-regression" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="a-brief-digression-polynomial-regression"><span class="header-section-number">3.3</span> A Brief Digression: Polynomial Regression</h2>
<p>I now extend the interaction idea to nonlinearity. In an interaction, the slope of one variable changes with another variable (x × z). With polynomial terms, the slope of a variable changes with its own level by including powers like x² and x³. Although both are multiplicative in form, polynomial terms are conventionally treated as predictor transformations (basis expansions), not as interaction terms. Using <code>age</code> as an example, our regression model with a cubic term would look like this: <span id="eq-reg-polynomial"><span class="math display">\[
leftRight_i = \alpha + \beta_1 age_i + \beta_2 age_i^2 + \beta_3 age_i^3 + \epsilon_i
\tag{3.5}\]</span></span></p>
<p>The partial derivative of <a href="#eq-reg-polynomial" class="quarto-xref">Equation&nbsp;<span>3.5</span></a> with respect to <code>age</code> is: <span id="eq-derivative-polynomial"><span class="math display">\[
\frac{\partial leftRight_i}{\partial age_i} = \beta_1 + 2 \beta_2 age_i + 3 \beta_3 age_i^2
\tag{3.6}\]</span></span></p>
<p>In R, a polynomial regression can be estimated by either using the <code>poly()</code> function (or including the polynomial terms manually) as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(leftRight <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="at">degree =</span> <span class="dv">3</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>), <span class="at">data =</span> data2)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = leftRight ~ poly(age, degree = 3, raw = TRUE), data = data2)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.25298 -0.55461  0.01145  0.54104  2.61350 

Coefficients:
                                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                         3.510e+00  5.398e-01   6.502 1.25e-10 ***
poly(age, degree = 3, raw = TRUE)1  1.861e-01  3.825e-02   4.865 1.33e-06 ***
poly(age, degree = 3, raw = TRUE)2 -3.574e-03  8.315e-04  -4.298 1.89e-05 ***
poly(age, degree = 3, raw = TRUE)3  2.323e-05  5.631e-06   4.126 4.00e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.8007 on 996 degrees of freedom
Multiple R-squared:  0.1354,    Adjusted R-squared:  0.1328 
F-statistic:    52 on 3 and 996 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>And the plot of the marginal effect of <code>age</code> on <code>leftRight</code> would look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the polynomial regression model with raw polynomials</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>model_poly <span class="ot">&lt;-</span> <span class="fu">lm</span>(leftRight <span class="sc">~</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">3</span>), <span class="at">data =</span> data2) </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coefficients and variance-covariance matrix</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(model_poly)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>vcov_matrix <span class="ot">&lt;-</span> <span class="fu">vcov</span>(model_poly)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create age sequence for prediction</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>age_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">18</span>, <span class="dv">80</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate marginal effect: β₁ + 2*β₂*age + 3*β₃*age²</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>effect <span class="ot">&lt;-</span> coefs[<span class="dv">2</span>] <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> coefs[<span class="dv">3</span>] <span class="sc">*</span> age_seq <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> coefs[<span class="dv">4</span>] <span class="sc">*</span> age_seq<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Delta method for standard error:</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># For f(β) = β₁ + 2*β₂*age + 3*β₃*age², gradient is [1, 2*age, 3*age²]</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># SE = sqrt(gradient' * Vcov * gradient)</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(vcov_matrix[<span class="dv">2</span>, <span class="dv">2</span>] <span class="sc">+</span> </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>           <span class="dv">4</span> <span class="sc">*</span> age_seq<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> vcov_matrix[<span class="dv">3</span>, <span class="dv">3</span>] <span class="sc">+</span> </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>           <span class="dv">9</span> <span class="sc">*</span> age_seq<span class="sc">^</span><span class="dv">4</span> <span class="sc">*</span> vcov_matrix[<span class="dv">4</span>, <span class="dv">4</span>] <span class="sc">+</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>           <span class="dv">4</span> <span class="sc">*</span> age_seq <span class="sc">*</span> vcov_matrix[<span class="dv">2</span>, <span class="dv">3</span>] <span class="sc">+</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>           <span class="dv">6</span> <span class="sc">*</span> age_seq<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> vcov_matrix[<span class="dv">2</span>, <span class="dv">4</span>] <span class="sc">+</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>           <span class="dv">12</span> <span class="sc">*</span> age_seq<span class="sc">^</span><span class="dv">3</span> <span class="sc">*</span> vcov_matrix[<span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 95% confidence intervals</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>ci_lower <span class="ot">&lt;-</span> effect <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>ci_upper <span class="ot">&lt;-</span> effect <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plot</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(age_seq, effect, </span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">"l"</span>, </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(ci_lower), <span class="fu">max</span>(ci_upper)),</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Age"</span>,</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">"Marginal Effect of Age on Left-Right Placement"</span>,</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Marginal Effect of Age</span><span class="sc">\n</span><span class="st">(with 95% Confidence Intervals)"</span>)</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Add confidence interval as shaded region</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(age_seq, <span class="fu">rev</span>(age_seq)), </span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(ci_upper, <span class="fu">rev</span>(ci_lower)),</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">rgb</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>),</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Add reference line at y=0</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"gray"</span>, <span class="at">lwd =</span> <span class="dv">1</span>)</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-plot the line on top</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age_seq, effect, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-marginal-effect-polynomial" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-marginal-effect-polynomial-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Interaction_Polynomials_files/figure-html/fig-marginal-effect-polynomial-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-marginal-effect-polynomial-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.3: Marginal effect of age on left-right placement from a cubic polynomial model. The U-shaped pattern shows a declining effect for younger respondents, a null zone in middle age, and a rising effect for older respondents.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The plot shows that the marginal effect of <code>age</code> on <code>leftRight</code> is positive but decreasing for younger respondents, becomes not statistically distinguishable from zero for respondents between mid-40s and mid-50s, and becomes positive and significant again for older respondents. This U-shaped pattern illustrates how polynomial regression can capture non-linear relationships between a predictor variable and a response variable. In this example, the relationship between <code>age</code> and <code>leftRight</code> follows a nonlinear pattern with changing slope that can be captured by including polynomial terms in the regression model.</p>
<p>Of course, other functional forms could be considered to capture different types of non-linear relationships. But the main point is that this example illustrates how polynomial regression can capture non-linear relationships between a predictor variable and a response variable.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Polynomials vs Splines
</div>
</div>
<div class="callout-body-container callout-body">
<p>Polynomial terms are easy to specify and interpret via partial derivatives, but high-order polynomials (degree &gt; 3) tend to produce wild extrapolation and overfitting at the boundaries of the data. For more flexible nonlinear relationships, consider restricted cubic splines (e.g., <code>rcs()</code> in the <code>rms</code> package) or generalized additive models (e.g., <code>gam()</code> in <code>mgcv</code>). These methods fit smooth curves without the boundary instability of high-order polynomials.</p>
</div>
</div>
<p>As an alternative to computing marginal effects and confidence intervals manually via the delta method, the <code>marginaleffects</code> package provides a convenient interface:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># For the interaction model: marginal effect of age across income values</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(leftRight <span class="sc">~</span> age <span class="sc">*</span> income, <span class="at">data =</span> data)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_slopes</span>(model, <span class="at">variables =</span> <span class="st">"age"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">income =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">12</span>, <span class="at">by =</span> <span class="dv">2</span>)))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># For the polynomial model: marginal effect of age across age values</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>model_poly <span class="ot">&lt;-</span> <span class="fu">lm</span>(leftRight <span class="sc">~</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">3</span>), <span class="at">data =</span> data2)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_slopes</span>(model_poly, <span class="at">variables =</span> <span class="st">"age"</span>, <span class="at">condition =</span> <span class="st">"age"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="practical-pitfalls" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="practical-pitfalls"><span class="header-section-number">3.4</span> Practical Pitfalls</h2>
<p><strong>Interpreting constitutive terms as unconditional effects.</strong> In a model with an interaction <span class="math inline">\(X \times Z\)</span>, the coefficient on <span class="math inline">\(X\)</span> is conditional on <span class="math inline">\(Z = 0\)</span>. If zero is not a meaningful or observed value of <span class="math inline">\(Z\)</span>, this coefficient has no useful interpretation without centering.</p>
<p><strong>Multicollinearity from uncentered interactions.</strong> When predictors are not centered, the interaction term <span class="math inline">\(X \times Z\)</span> can be highly correlated with <span class="math inline">\(X\)</span> and <span class="math inline">\(Z\)</span>, inflating standard errors. Centering both variables before computing the interaction reduces this collinearity without affecting the substantive results.</p>
<p><strong>Overfitting with high-order polynomials.</strong> Each additional polynomial degree adds flexibility but also a parameter. Cubic or quartic fits may capture noise rather than signal, especially with moderate sample sizes. Compare models via AIC/BIC or cross-validation, and prefer splines for high-flexibility needs.</p>
<p><strong>Interaction power.</strong> As discussed in the chapter on comparing estimates, detecting an interaction typically requires substantially more statistical power than detecting a main effect of comparable magnitude. A non-significant interaction should not be interpreted as evidence of no moderation without a power analysis.</p>
<p><strong>Extrapolation beyond observed data.</strong> Both interaction and polynomial models can produce misleading predictions outside the observed range of the predictors. Always check that the values used for plotting and interpretation fall within (or near) the range of the data.</p>
</section>
<section id="appendix-which-specification-when-cheat-sheet" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="appendix-which-specification-when-cheat-sheet"><span class="header-section-number">3.5</span> Appendix: “Which Specification When?” Cheat Sheet</h2>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Quick reference: choosing an interaction or nonlinearity specification</caption>
<colgroup>
<col style="width: 27%">
<col style="width: 39%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Scenario</th>
<th style="text-align: left;">Recommended Approach</th>
<th style="text-align: left;">Key Assumption</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Continuous × continuous interaction</td>
<td style="text-align: left;">Center both variables; plot marginal effects with CIs across moderator range</td>
<td style="text-align: left;">Sufficient variation in both X and Z; meaningful zero or centered values</td>
</tr>
<tr class="even">
<td style="text-align: left;">Continuous × categorical interaction</td>
<td style="text-align: left;">Interaction = group-specific slopes; plot predicted values or marginal effects by group</td>
<td style="text-align: left;">Common error variance across groups or robust SEs</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Categorical × categorical interaction</td>
<td style="text-align: left;">Interaction = cell-specific means; compare group contrasts via post-hoc tests or marginal means</td>
<td style="text-align: left;">Sufficient cell sizes; multiple-comparison correction if many groups</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nonlinear relationship (moderate curvature)</td>
<td style="text-align: left;">Quadratic or cubic polynomial; plot marginal effect via partial derivative</td>
<td style="text-align: left;">True relationship is well-approximated by a low-order polynomial</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nonlinear relationship (complex/unknown shape)</td>
<td style="text-align: left;">Restricted cubic splines (rcs) or GAM; plot smooth marginal effect</td>
<td style="text-align: left;">Smoothness; sufficient data density across predictor range</td>
</tr>
<tr class="even">
<td style="text-align: left;">Effect differs across groups (separate regressions vs interaction)</td>
<td style="text-align: left;">Pooled model with interaction preferred over split-sample (see Comparing Estimates chapter)</td>
<td style="text-align: left;">Same functional form in both groups; adequate sample size for interaction power</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="further-reading" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="further-reading"><span class="header-section-number">3.6</span> Further Reading</h2>
<ol type="1">
<li><p><strong>Brambor, T., Clark, W. R. &amp; Golder, M. (2006).</strong> “Understanding Interaction Models: Improving Empirical Analyses.” <em>Political Analysis</em>, 14(1), 63–82.</p></li>
<li><p><strong>Berry, W. D., Golder, M. &amp; Milton, D. (2012).</strong> “Improving Tests of Theories Positing Interaction.” <em>Journal of Politics</em>, 74(3), 653–671.</p></li>
<li><p><strong>Hainmueller, J., Mummolo, J. &amp; Xu, Y. (2019).</strong> “How Much Should We Trust Estimates from Multiplicative Interaction Models? Simple Tools to Improve Empirical Practice.” <em>Political Analysis</em>, 27(2), 163–192.</p></li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/Categorical_Compositional.html" class="pagination-link" aria-label="Categorical and Compositional Predictors: A Guide">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Categorical and Compositional Predictors: A Guide</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/Comparing_Estimates.html" class="pagination-link" aria-label="Comparing Estimates Correctly: Why 'Significant' vs 'Not Significant' Is Not a Difference">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Comparing Estimates Correctly: Why ‘Significant’ vs ‘Not Significant’ Is Not a Difference</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>